<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VB Team Manager 2026</title>
    <style>
        :root {
            --bg-dark: #121212;
            --panel-bg: #1e1e1e;
            --neon-green: #39FF14;
            --text-color: #e0e0e0;
            --danger: #ff4d4d;
            --border: #333;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: var(--bg-dark);
            color: var(--text-color);
        }

        /* Mobile-Friendly Navigation */
        nav {
            background: #000;
            display: flex;
            padding: 10px;
            gap: 10px;
            border-bottom: 1px solid var(--border);
        }

        .tab-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--text-color);
            padding: 10px;
            cursor: pointer;
            flex: 1;
            border-radius: 4px;
        }

        .tab-btn.active {
            background: var(--neon-green);
            color: #000;
            border-color: var(--neon-green);
            font-weight: bold;
        }

        main { display: flex; flex: 1; overflow: hidden; }

        /* Roster Sidebar */
        #roster-section {
            width: 320px;
            background: var(--panel-bg);
            border-right: 1px solid var(--border);
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .roster-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        .roster-table th { color: var(--neon-green); border-bottom: 2px solid var(--neon-green); text-align: left; }
        .roster-table td { padding: 5px; border-bottom: 1px solid var(--border); }

        input[type="text"], input[type="number"] {
            background: #000; border: 1px solid var(--border); color: #fff; padding: 5px; border-radius: 3px;
        }

        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: auto; }
        button { border-radius: 4px; border: none; padding: 8px; cursor: pointer; background: #444; color: white; }
        button:hover { opacity: 0.8; }
        .btn-green { background: #28a745; }
        .btn-del { background: var(--danger); font-size: 0.8em; }

        /* Tools Area */
        #tool-content { flex: 1; padding: 20px; overflow-y: auto; }
        .tool-panel { display: none; }
        .tool-panel.active { display: block; }

        /* Assignments UI */
        .job-pool-config {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px; background: #000; padding: 15px; border-radius: 8px; margin-bottom: 20px;
        }

        .assignment-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .assignment-table th { background: var(--neon-green); color: #000; padding: 10px; }
        .assignment-table td { border: 1px solid var(--border); padding: 8px; text-align: center; }

        /* Captain Picker UI */
        .captain-display { display: flex; justify-content: center; gap: 20px; margin: 20px 0; }
        .captain-card {
            background: #000; border: 2px solid var(--neon-green); padding: 20px;
            min-width: 120px; text-align: center; border-radius: 8px; color: var(--neon-green);
        }

        @keyframes selectFlare {
            0% { transform: scale(1); box-shadow: 0 0 0 var(--neon-green); }
            50% { transform: scale(1.1); box-shadow: 0 0 20px var(--neon-green); background: var(--neon-green); color: #000; }
            100% { transform: scale(1); box-shadow: 0 0 5px var(--neon-green); }
        }
        .flare { animation: selectFlare 0.6s ease-in-out 2; }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            main { flex-direction: column; }
            #roster-section { width: auto; max-height: 40%; border-right: none; border-bottom: 1px solid var(--border); }
        }
    </style>
</head>
<body>

<nav>
    <button class="tab-btn active" onclick="showTool('work-tool', this)">Assignments</button>
    <button class="tab-btn" onclick="showTool('captain-tool', this)">Captains</button>
</nav>

<main>
    <section id="roster-section">
        <h3>Roster</h3>
        <div style="overflow-y: auto;">
            <table class="roster-table">
                <thead><tr><th>In</th><th>Name</th><th>#</th><th></th></tr></thead>
                <tbody id="rosterBody"></tbody>
            </table>
        </div>
        <div class="controls">
            <button onclick="addPlayer()">+ Player</button>
            <button onclick="sortRoster()">Sort #</button>
            <button class="btn-green" onclick="saveRoster()">Save</button>
            <button onclick="loadRoster()">Load</button>
        </div>
    </section>

    <section id="tool-content">
        <div id="work-tool" class="tool-panel active">
            <h2>Work Assignments</h2>
            <div class="job-pool-config">
                <label><input type="checkbox" class="job-check" value="Lines 1" checked> Lines 1</label>
                <label><input type="checkbox" class="job-check" value="Bookkeeper" checked> Bookkeeper</label>
                <label><input type="checkbox" class="job-check" value="Scorekeeper" checked> Scorekeeper</label>
                <label><input type="checkbox" class="job-check" value="Lines 2" checked> Lines 2</label>
                <label><input type="checkbox" class="job-check" value="Down Ref" checked> Down Ref</label>
                <label><input type="checkbox" class="job-check" value="Libero Tracker" checked> Libero Tracker</label>
            </div>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                <label>Sets: <input type="number" id="sets" value="3" style="width: 40px;"></label>
                <label>Start # (optional): <input type="number" id="startJersey" style="width: 50px;"></label>
                <button class="btn-green" onclick="generate()">Generate Assignments</button>
            </div>
            <div id="assignTable"></div>
        </div>

        <div id="captain-tool" class="tool-panel">
            <h2>Captain Picker</h2>
            <button class="btn-green" onclick="pick()" style="padding: 15px 30px; font-weight: bold;">[ PICK CAPTAINS ]</button>
            <div class="captain-display">
                <div class="captain-card" id="cap1">?</div>
                <div class="captain-card" id="cap2">?</div>
            </div>
            <div id="history" style="font-size: 0.9em; opacity: 0.7;"></div>
        </div>
    </section>
</main>

<script>
    let roster = [
        { name: "Player 1", number: "1", active: true },
        { name: "Player 2", number: "2", active: true },
        { name: "Player 3", number: "3", active: true },
        { name: "Player 4", number: "4", active: true },
        { name: "Player 5", number: "5", active: true },
        { name: "Player 6", number: "6", active: true }
    ];

    function render() {
        const body = document.getElementById('rosterBody');
        body.innerHTML = '';
        roster.forEach((p, i) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><input type="checkbox" ${p.active ? 'checked' : ''} onchange="update(${i}, 'active', this.checked)"></td>
                <td><input type="text" value="${p.name}" onchange="update(${i}, 'name', this.value)" style="width: 80px;"></td>
                <td><input type="number" value="${p.number}" onchange="update(${i}, 'number', this.value)" style="width: 40px;"></td>
                <td><button class="btn-del" onclick="del(${i})">X</button></td>
            `;
            body.appendChild(tr);
        });
    }

    function update(i, k, v) { roster[i][k] = v; }
    function del(i) { roster.splice(i, 1); render(); }
    function addPlayer() { roster.push({name: "New", number: "", active: true}); render(); }
    function sortRoster() { roster.sort((a,b) => Number(a.number) - Number(b.number)); render(); }
    function saveRoster() { localStorage.setItem('vb_roster_2026', JSON.stringify(roster)); }
    function loadRoster() { const d = localStorage.getItem('vb_roster_2026'); if(d) { roster = JSON.parse(d); render(); } }
    function showTool(id, btn) {
        document.querySelectorAll('.tool-panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
    }

    function generate() {
        sortRoster();
        const players = roster.filter(p => p.active);
        const jobs = Array.from(document.querySelectorAll('.job-check:checked')).map(c => c.value);
        if(!players.length || !jobs.length) return;

        const setTotal = parseInt(document.getElementById('sets').value) || 1;
        const start = document.getElementById('startJersey').value;
        let pIndex = players.findIndex(p => p.number == start);
        if(pIndex === -1) pIndex = 0;

        let html = '<table class="assignment-table"><thead><tr><th>Set</th>';
        jobs.forEach(j => html += `<th>${j}</th>`);
        html += '</tr></thead><tbody>';

        for (let s = 1; s <= setTotal; s++) {
            html += `<tr><td>${s}</td>`;
            jobs.forEach(() => {
                const p = players[pIndex % players.length];
                html += `<td>${p.name} (#${p.number})</td>`;
                pIndex++;
            });
            // SHIFT LOGIC: Increment pIndex by 1 additional spot at the end of each set
            // This prevents "even" groups from getting the same jobs repeatedly.
            pIndex++; 
            html += '</tr>';
        }
        document.getElementById('assignTable').innerHTML = html + '</tbody></table>';
    }

    function pick() {
        let pool = roster.map((p, i) => p.active ? i : -1).filter(i => i !== -1);
        if (pool.length < 2) {
            roster.forEach(p => p.active = true); // Reset pool without alert
            render();
            pool = roster.map((p, i) => i);
        }
        const i1 = pool.splice(Math.floor(Math.random() * pool.length), 1)[0];
        const i2 = pool.splice(Math.floor(Math.random() * pool.length), 1)[0];
        
        const c1 = document.getElementById('cap1');
        const c2 = document.getElementById('cap2');
        c1.innerText = `${roster[i1].name} (#${roster[i1].number})`;
        c2.innerText = `${roster[i2].name} (#${roster[i2].number})`;

        [c1, c2].forEach(el => {
            el.classList.remove('flare');
            void el.offsetWidth;
            el.classList.add('flare');
        });

        roster[i1].active = roster[i2].active = false;
        render();
        document.getElementById('history').innerHTML += `<div>Picked: ${roster[i1].name} & ${roster[i2].name}</div>`;
    }

    render();
	
	function initApp() {
    const savedData = localStorage.getItem('vb_roster_2026');
    
    if (savedData) {
        // Automatically load from localStorage if it exists
        try {
            roster = JSON.parse(savedData);
            console.log("Roster automatically loaded from storage.");
        } catch (e) {
            console.error("Error parsing saved roster, falling back to default.", e);
        }
    } else {
        // Fallback to the default roster defined at the top of the script
        console.log("No saved roster found. Loading defaults.");
    }
    
    // Always render the roster to the UI regardless of source
    render();
}

// Call the initialization function when the page is ready
// Placing it at the end of your script ensures all functions are defined
initApp();
</script>
</body>
</html>
