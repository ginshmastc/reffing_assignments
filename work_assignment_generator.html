<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VB Team Manager 2026</title>
    <style>
        :root {
            --bg-dark: #121212;
            --panel-bg: #1e1e1e;
            --neon-green: #39FF14;
            --text-color: #e0e0e0;
            --danger: #ff4d4d;
            --border: #444;
            --primary-btn-bg: #28a745;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: var(--bg-dark);
            color: var(--text-color);
        }

        /* Navigation Tabs */
        nav {
            background: #000;
            display: flex;
            padding: 10px 15px;
            gap: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .tab-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--text-color);
            padding: 10px 15px;
            cursor: pointer;
            flex: 1;
            transition: background 0.3s, color 0.3s, border-color 0.3s;
        }

        .tab-btn.active {
            background: var(--neon-green);
            color: var(--bg-dark);
            font-weight: bold;
            border-color: var(--neon-green);
        }

        /* Main Layout */
        main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Roster Sidebar */
        #roster-section {
            width: 350px;
            background: var(--panel-bg);
            border-right: 1px solid var(--border);
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .roster-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        .roster-table th, .roster-table td { padding: 8px; border-bottom: 1px solid var(--border); text-align: left; }
        .roster-table th { color: var(--neon-green); border-bottom: 2px solid var(--neon-green); }

        input[type="text"], input[type="number"] {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            color: var(--text-color);
            padding: 5px;
            width: 90%;
            border-radius: 4px;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: auto;
        }

        /* General Buttons */
        button {
            padding: 10px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background: var(--primary-btn-bg);
            color: white;
            transition: opacity 0.2s;
        }
        button:hover { opacity: 0.85; }

        .btn-delete { background: var(--danger); padding: 5px 10px; }
        .btn-sort { background: #555; }
        .btn-load { background: #555; }

        /* Tools Area */
        #tool-content { flex: 1; padding: 20px; overflow-y: auto; }
        .tool-panel { display: none; }
        .tool-panel.active { display: block; }

        h2 { color: var(--neon-green); border-bottom: 1px solid var(--border); padding-bottom: 10px; }

        /* Assignment UI */
        .job-pool-config {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .assignment-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .assignment-table th { background: var(--neon-green); color: var(--bg-dark); padding: 12px; }
        .assignment-table td { border: 1px solid var(--border); padding: 10px; text-align: center; }

        /* Captain Picker UI */
        .captain-container { text-align: center; }
        .captain-display { display: flex; justify-content: center; gap: 30px; margin: 30px 0; }
        .captain-card {
            background: var(--panel-bg);
            border: 2px solid var(--neon-green);
            padding: 20px;
            min-width: 150px;
            font-size: 24px;
            color: var(--neon-green);
            border-radius: 8px;
        }

        /* Flare (more subtle) */
        @keyframes subtleGlow {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; background: var(--neon-green); color: var(--bg-dark);}
            100% { transform: scale(1); opacity: 1; }
        }
        .picked-flare { animation: subtleGlow 0.6s ease-out 2; }

        .history-list { max-width: 400px; margin: 20px auto; border-top: 1px solid var(--border); padding-top: 15px;}
        .history-list div { padding: 4px 0; border-bottom: 1px solid #333; }

        /* Responsiveness for mobile */
        @media (max-width: 768px) {
            main { flex-direction: column; }
            #roster-section { width: auto; border-right: none; border-bottom: 1px solid var(--border); max-height: 40vh; }
            .job-pool-config { grid-template-columns: repeat(2, 1fr); }
            .captain-display { flex-direction: column; gap: 10px; }
            .captain-card { min-width: auto; }
        }
    </style>
</head>
<body>

<nav>
    <button class="tab-btn active" onclick="showTool('work-tool', this)">Reffing Work</button>
    <button class="tab-btn" onclick="showTool('captain-tool', this)">Captain Picker</button>
</nav>

<main>
    <section id="roster-section">
        <h2 style="margin-top: 0;">Team Roster</h2>
        <div style="overflow-y: auto; flex: 1;">
            <table class="roster-table">
                <thead>
                    <tr>
                        <th>In</th>
                        <th>Name</th>
                        <th>#</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="rosterBody"></tbody>
            </table>
        </div>
        <div class="controls">
            <button onclick="addRow()">+ Player</button>
            <button class="btn-sort" onclick="sortRosterByNumber()">Sort #</button>
            <button onclick="saveRoster()">Save Local</button>
            <button class="btn-load" onclick="loadRoster()">Load Last</button>
        </div>
    </section>

    <section id="tool-content">
        <!-- Work assignments -->
        <div id="work-tool" class="tool-panel active">
            <h2>Work Assignments</h2>
            <div class="job-pool-config">
                <label><input type="checkbox" class="job-check" value="Lines 1" checked> Lines 1</label>
                <label><input type="checkbox" class="job-check" value="Bookkeeper" checked> Bookkeeper</label>
                <label><input type="checkbox" class="job-check" value="Scorekeeper" checked> Scorekeeper</label>
                <label><input type="checkbox" class="job-check" value="Lines 2" checked> Lines 2</label>
                <label><input type="checkbox" class="job-check" value="Down Ref" checked> Down Ref</label>
                <label><input type="checkbox" class="job-check" value="Libero Tracker" checked> Libero Tracker</label>
            </div>
            
            <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                <div>Sets: <input type="number" id="setCount" value="3" style="width: 50px;"></div>
                <div>Start with (#): <input type="number" id="startJersey" style="width: 60px;"></div>
                <button onclick="generateAssignments()">Generate Assignments</button>
            </div>
            <div id="assignmentResult"></div>
        </div>

        <!-- Captain Picker -->
        <div id="captain-tool" class="tool-panel">
            <div class="captain-container">
                <h2>Captain Picker</h2>
                <button onclick="pickCaptains()" style="font-size: 1.1em; padding: 15px 30px; margin: 10px;">Pick Captains!</button>
                
                <div class="captain-display">
                    <div class="captain-card" id="cap1">---</div>
                    <div class="captain-card" id="cap2">---</div>
                </div>

                <div class="history-list">
                    <strong>Past Captains (this session):</strong>
                    <div id="historyItems"></div>
                </div>
            </div>
        </div>
    </section>
</main>

<script>
    let roster = [
        { name: "Alpha", number: "1", active: true },
        { name: "Beta", number: "5", active: true },
        { name: "Gamma", number: "10", active: true },
        { name: "Delta", number: "14", active: true },
        { name: "Epsilon", number: "20", active: true },
        { name: "Zeta", number: "33", active: true }
    ];

    function renderRoster() {
        const tbody = document.getElementById('rosterBody');
        tbody.innerHTML = '';
        roster.forEach((player, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="checkbox" ${player.active ? 'checked' : ''} onchange="updatePlayer(${index}, 'active', this.checked)"></td>
                <td><input type="text" value="${player.name}" onchange="updatePlayer(${index}, 'name', this.value)" style="width: 100px;"></td>
                <td><input type="number" value="${player.number}" onchange="updatePlayer(${index}, 'number', this.value)" style="width: 40px;"></td>
                <td><button class="btn-delete" onclick="removePlayer(${index})">X</button></td>
            `;
            tbody.appendChild(row);
        });
    }

    function updatePlayer(index, field, value) { roster[index][field] = value; }
    function addRow() { roster.push({ name: "Player", number: "", active: true }); renderRoster(); }
    function removePlayer(index) { roster.splice(index, 1); renderRoster(); }
    function sortRosterByNumber() { roster.sort((a, b) => Number(a.number) - Number(b.number)); renderRoster(); }
    function saveRoster() { localStorage.setItem('vbRosterDark', JSON.stringify(roster)); }
    function loadRoster() {
        const data = localStorage.getItem('vbRosterDark');
        if (data) { roster = JSON.parse(data); renderRoster(); }
    }

    function showTool(toolId, btn) {
        document.querySelectorAll('.tool-panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(toolId).classList.add('active');
        btn.classList.add('active');
    }

    // Work assignments logic (same as before, now uses the 'checked' state of job checkboxes)
    function generateAssignments() {
        sortRosterByNumber();
        const pool = roster.filter(p => p.active);
        if (pool.length === 0) return alert("Roster pool is empty!");
        const jobs = Array.from(document.querySelectorAll('.job-check:checked')).map(c => c.value);
        if (jobs.length === 0) return alert("No jobs selected.");

        const sets = parseInt(document.getElementById('setCount').value) || 1;
        const startNum = document.getElementById('startJersey').value;
        let pointer = pool.findIndex(p => p.number == startNum);
        if (pointer === -1) pointer = 0;

        let html = `<table class="assignment-table"><thead><tr><th>Set</th>`;
        jobs.forEach(j => html += `<th>${j}</th>`);
        html += `</tr></thead><tbody>`;

        for (let s = 1; s <= sets; s++) {
            html += `<tr><td>Set ${s}</td>`;
            jobs.forEach(() => {
                const p = pool[pointer % pool.length];
                html += `<td>${p.name} (#${p.number})</td>`;
                pointer++;
            });
            html += `</tr>`;
        }
        document.getElementById('assignmentResult').innerHTML = html + `</tbody></table>`;
    }

    // Captain Picker logic
    function pickCaptains() {
        let activeIndices = roster.map((p, i) => p.active ? i : -1).filter(i => i !== -1);

        // If pool is exhausted, silently reset
        if (activeIndices.length < 2) {
            roster.forEach(p => p.active = true);
            activeIndices = roster.map((p, i) => i);
        }

        // Pick two players randomly
        const pick1Index = activeIndices.splice(Math.floor(Math.random() * activeIndices.length), 1)[0];
        const pick2Index = activeIndices.splice(Math.floor(Math.random() * activeIndices.length), 1)[0];
        
        const p1 = roster[pick1Index];
        const p2 = roster[pick2Index];

        // Update display and add flare
        const c1 = document.getElementById('cap1');
        const c2 = document.getElementById('cap2');
        c1.innerText = `${p1.name} (#${p1.number})`;
        c2.innerText = `${p2.name} (#${p2.number})`;
        
        [c1, c2].forEach(el => {
            el.classList.remove('picked-flare');
            void el.offsetWidth;
            el.classList.add('picked-flare');
        });

        // Remove from pool (in-memory) and refresh visual roster
        p1.active = false;
        p2.active = false;
        renderRoster();

        // History
        const hist = document.getElementById('historyItems');
        hist.innerHTML = `<div>&gt; ${p1.name} & ${p2.name}</div>` + hist.innerHTML;
    }

    // Initial Load
    renderRoster();
</script>

</body>
</html>
