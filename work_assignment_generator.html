<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VB Team Manager 2026</title>
    <style>
        :root { --bg-dark: #121212; --panel-bg: #1e1e1e; --neon-green: #39FF14; --text-color: #e0e0e0; --danger: #ff4d4d; --border: #333; }
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background-color: var(--bg-dark); color: var(--text-color); }
        nav { background: #000; display: flex; padding: 10px; gap: 10px; border-bottom: 1px solid var(--border); }
        .tab-btn { background: none; border: 1px solid var(--border); color: var(--text-color); padding: 10px; cursor: pointer; flex: 1; border-radius: 4px; }
        .tab-btn.active { background: var(--neon-green); color: #000; border-color: var(--neon-green); font-weight: bold; }
        main { display: flex; flex: 1; overflow: hidden; }
        #roster-section { width: 320px; background: var(--panel-bg); border-right: 1px solid var(--border); padding: 15px; display: flex; flex-direction: column; }
        .roster-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        .roster-table th { color: var(--neon-green); border-bottom: 2px solid var(--neon-green); text-align: left; }
        .roster-table td { padding: 5px; border-bottom: 1px solid var(--border); }
        input[type="text"], input[type="number"] { background: #000; border: 1px solid var(--border); color: #fff; padding: 5px; border-radius: 3px; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: auto; }
        button { border-radius: 4px; border: none; padding: 8px; cursor: pointer; background: #444; color: white; }
        .btn-green { background: #28a745; }
        .btn-del { background: var(--danger); font-size: 0.8em; }
        #tool-content { flex: 1; padding: 20px; overflow-y: auto; }
        .tool-panel { display: none; }
        .tool-panel.active { display: block; }
        .job-pool-config { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; background: #000; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .assignment-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .assignment-table th { background: var(--neon-green); color: #000; padding: 10px; }
        .assignment-table td { border: 1px solid var(--border); padding: 8px; text-align: center; }
        .captain-display { display: flex; justify-content: center; gap: 20px; margin: 20px 0; }
        .captain-card { background: #000; border: 2px solid var(--neon-green); padding: 20px; min-width: 120px; text-align: center; border-radius: 8px; color: var(--neon-green); }
        .flare { animation: selectFlare 0.6s ease-in-out 2; }
        @keyframes selectFlare { 0% { transform: scale(1); } 50% { transform: scale(1.1); background: var(--neon-green); color: #000; } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<nav>
    <button class="tab-btn active" onclick="showTool('work-tool', this)">Assignments</button>
    <button class="tab-btn" onclick="showTool('captain-tool', this)">Captains</button>
</nav>

<main>
    <section id="roster-section">
        <h3>Roster</h3>
        <div style="overflow-y: auto;">
            <table class="roster-table">
                <thead><tr><th>In</th><th>Name</th><th>#</th><th></th></tr></thead>
                <tbody id="rosterBody"></tbody>
            </table>
        </div>
        <div class="controls">
            <button onclick="addPlayer()">+ Player</button>
            <button onclick="sortRoster()">Sort #</button>
            <button class="btn-green" onclick="saveRoster()">Save</button>
            <button onclick="loadRoster()">Refresh</button>
        </div>
    </section>

    <section id="tool-content">
        <div id="work-tool" class="tool-panel active">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h2>Work Assignments</h2>
                <button class="btn-del" onclick="resetShiftCounter()" style="padding: 10px; min-width: 150px;">
                    reset # times reffed<br><strong id="counterVal">0</strong>
                </button>
            </div>
            
            <div class="job-pool-config">
                <label><input type="checkbox" class="job-check" value="Lines 1" checked> Lines 1</label>
                <label><input type="checkbox" class="job-check" value="Bookkeeper" checked> Bookkeeper</label>
                <label><input type="checkbox" class="job-check" value="Scorekeeper" checked> Scorekeeper</label>
                <label><input type="checkbox" class="job-check" value="Lines 2" checked> Lines 2</label>
                <label><input type="checkbox" class="job-check" value="Down Ref" checked> Down Ref</label>
                <label><input type="checkbox" class="job-check" value="Libero Tracker" checked> Libero Tracker</label>
            </div>
            
            <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 15px; align-items: center;">
                <label>Sets: <input type="number" id="sets" value="3" style="width: 50px;"></label>
                <button class="btn-green" onclick="generate()" style="padding: 10px 20px;">Generate Assignments</button>
            </div>
            <div id="assignTable"></div>
        </div>

        <div id="captain-tool" class="tool-panel">
            <h2>Captain Picker</h2>
            <button class="btn-green" onclick="pick()" style="padding: 15px 30px; font-weight: bold;">[ PICK CAPTAINS ]</button>
            <div class="captain-display">
                <div class="captain-card" id="cap1">?</div>
                <div class="captain-card" id="cap2">?</div>
            </div>
        </div>
    </section>
</main>

<script>
// Load persistent data or defaults for 2026
let roster = JSON.parse(localStorage.getItem('vb-roster')) || [
    { name: "Player 1", number: "1", active: true },
    { name: "Player 2", number: "2", active: true },
    { name: "Player 3", number: "3", active: true },
    { name: "Player 4", number: "4", active: true },
    { name: "Player 5", number: "5", active: true },
    { name: "Player 6", number: "6", active: true }
];

let globalPointer = parseInt(localStorage.getItem('vb-pointer')) || 0;
let shiftCounter = parseInt(localStorage.getItem('vb-shift-counter')) || 0;

function saveState() {
    localStorage.setItem('vb-pointer', globalPointer);
    localStorage.setItem('vb-shift-counter', shiftCounter);
    document.getElementById('counterVal').innerText = shiftCounter;
}

function resetShiftCounter() {
    shiftCounter = 0;
    globalPointer = 0;
    saveState();
    render(); 
    alert("Counter and rotation reset.");
}

// UI Navigation
function showTool(toolId, btn) {
    document.querySelectorAll('.tool-panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(toolId).classList.add('active');
    btn.classList.add('active');
}

// RESTORED: Core Rendering Function
function render() {
    const tbody = document.getElementById('rosterBody');
    if (!tbody) return;
    tbody.innerHTML = '';
    roster.forEach((p, i) => {
        tbody.innerHTML += `<tr>
            <td><input type="checkbox" ${p.active ? 'checked' : ''} onchange="togglePlayer(${i})"></td>
            <td><input type="text" value="${p.name}" onchange="updateName(${i}, this.value)"></td>
            <td><input type="number" value="${p.number}" onchange="updateNum(${i}, this.value)" style="width:40px"></td>
            <td><button class="btn-del" onclick="removePlayer(${i})">X</button></td>
        </tr>`;
    });
    document.getElementById('counterVal').innerText = shiftCounter;
}

// Roster Management
function addPlayer() { roster.push({ name: "New", number: "0", active: true }); render(); }
function togglePlayer(i) { roster[i].active = !roster[i].active; render(); }
function updateName(i, val) { roster[i].name = val; }
function updateNum(i, val) { roster[i].number = val; }
function removePlayer(i) { roster.splice(i, 1); render(); }
function sortRoster() { roster.sort((a, b) => parseInt(a.number) - parseInt(b.number)); render(); }
function saveRoster() { localStorage.setItem('vb-roster', JSON.stringify(roster)); alert("Roster Saved!"); }
function loadRoster() { location.reload(); }

// Optimized Job Generation
function generate() {
    const activePlayers = roster.filter(p => p.active);
    const jobs = Array.from(document.querySelectorAll('.job-check:checked')).map(c => c.value);
    const numSets = parseInt(document.getElementById('sets').value);
    
    if (activePlayers.length === 0 || jobs.length === 0) return;

    let html = `<table class="assignment-table"><thead><tr><th>Set</th>`;
    jobs.forEach(j => html += `<th>${j}</th>`);
    html += `</tr></thead><tbody>`;

    let currentPointer = globalPointer;
    const numJobs = jobs.length;

    for (let s = 0; s < numSets; s++) {
        html += `<tr><td>${s + 1}</td>`;
        
        // 2026 Double-Prime Offset Logic:
        // shiftCounter * 11 ensures each full roster cycle starts with a massive job jump
        // s * 1 adds a small "drift" per set so players don't repeat jobs within the same cycle
        let totalOffset = (shiftCounter * 11 + s) % numJobs;
        let setAssignments = new Array(numJobs);

        for (let j = 0; j < numJobs; j++) {
            let playerIdx = (currentPointer + j) % activePlayers.length;
            let targetJobIdx = (j + totalOffset) % numJobs;
            setAssignments[targetJobIdx] = `${activePlayers[playerIdx].name} (#${activePlayers[playerIdx].number})`;
        }

        setAssignments.forEach(entry => html += `<td>${entry}</td>`);
        html += `</tr>`;

        // Advance pointer and increment counter on roster exhaustion
        for(let step = 0; step < numJobs; step++) {
            currentPointer++;
            if (currentPointer >= activePlayers.length) {
                currentPointer = 0; 
                shiftCounter++; 
            }
        }
    }

    globalPointer = currentPointer;
    saveState();
    html += `</tbody></table>`;
    document.getElementById('assignTable').innerHTML = html;
}



function pick() {
    const active = roster.filter(p => p.active);
    if (active.length < 2) return;
    const shuffled = [...active].sort(() => 0.5 - Math.random());
    const d1 = document.getElementById('cap1'), d2 = document.getElementById('cap2');
    [d1, d2].forEach(d => { d.classList.remove('flare'); void d.offsetWidth; d.classList.add('flare'); });
    d1.innerText = `${shuffled[0].name}\n#${shuffled[0].number}`;
    d2.innerText = `${shuffled[1].name}\n#${shuffled[1].number}`;
}

// Initial Launch
render();
</script>

</body>
</html>
