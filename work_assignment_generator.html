<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VB Manager 2026</title>
    <style>
        :root {
            --bg-dark: #121212;
            --panel-bg: #1e1e1e;
            --neon-green: #39FF14;
            --text-color: #e0e0e0;
            --danger: #ff4d4d;
            --border: #333;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            margin: 0; padding: 0;
            background-color: var(--bg-dark);
            color: var(--text-color);
            display: flex; flex-direction: column;
            height: 100vh; overflow: hidden;
        }

        /* Mobile Nav */
        nav {
            background: #000;
            display: flex;
            padding: 10px; gap: 8px;
            border-bottom: 1px solid var(--border);
        }

        .tab-btn {
            background: #222; border: 1px solid var(--border);
            color: #aaa; padding: 12px; cursor: pointer;
            flex: 1; border-radius: 8px; font-weight: bold; font-size: 14px;
        }

        .tab-btn.active {
            background: var(--neon-green); color: #000;
            border-color: var(--neon-green);
        }

        main { display: flex; flex: 1; overflow: hidden; flex-direction: row; }

        /* Sidebar/Roster Section */
        #roster-section {
            width: 300px; background: var(--panel-bg);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column;
        }

        .roster-header { padding: 15px; border-bottom: 1px solid var(--border); }
        #rosterBody { flex: 1; overflow-y: auto; padding: 10px; }

        /* Mobile-friendly player rows */
        .player-row {
            display: flex; align-items: center; gap: 8px;
            background: #282828; margin-bottom: 8px;
            padding: 10px; border-radius: 8px; border: 1px solid #333;
        }
        .player-row input[type="text"] { flex: 1; min-width: 0; }
        .player-row input[type="number"] { width: 45px; text-align: center; }

        .controls { 
            padding: 15px; background: #000;
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
        }

        /* Tool Panels */
        #tool-content { flex: 1; padding: 15px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .tool-panel { display: none; }
        .tool-panel.active { display: block; }

        /* Settings Grid */
        .job-pool-config {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 8px; background: #000; padding: 12px; border-radius: 8px; margin-bottom: 15px;
        }
        .job-pool-config label { font-size: 14px; display: flex; align-items: center; gap: 5px; }

        /* Assignment Table - Scrollable on mobile */
        .table-wrapper { width: 100%; overflow-x: auto; border-radius: 8px; border: 1px solid var(--border); }
        .assignment-table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .assignment-table th { background: var(--neon-green); color: #000; padding: 12px; font-size: 13px; }
        .assignment-table td { border-bottom: 1px solid var(--border); padding: 10px; text-align: center; background: #1a1a1a; font-size: 13px; }

        /* Inputs & Buttons */
        input { background: #000; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 5px; }
        button { border-radius: 6px; border: none; padding: 10px; cursor: pointer; font-weight: bold; }
        .btn-green { background: #28a745; color: white; }
        .btn-del { background: var(--danger); color: white; }
        .btn-main { background: var(--neon-green); color: #000; width: 100%; padding: 15px; font-size: 16px; }

        .reset-container { margin-bottom: 20px; text-align: center; }

        /* RESPONSIVE DESIGN */
        @media (max-width: 850px) {
            main { flex-direction: column; }
            #roster-section { width: 100%; height: 40vh; border-right: none; border-bottom: 1px solid var(--border); }
            #tool-content { height: 60vh; }
        }
    </style>
</head>
<body>

<nav>
    <button class="tab-btn active" onclick="showTool('work-tool', this)">Assignments</button>
    <button class="tab-btn" onclick="showTool('captain-tool', this)">Captains</button>
</nav>

<main>
    <section id="roster-section">
        <div class="roster-header"><strong>Team Roster</strong></div>
        <div id="rosterBody"></div>
        <div class="controls">
            <button onclick="addPlayer()">+ Player</button>
            <button onclick="sortRoster()">Sort #</button>
            <button class="btn-green" style="grid-column: span 2" onclick="saveRoster()">Save Roster</button>
        </div>
    </section>

    <section id="tool-content">
        <div id="work-tool" class="tool-panel active">
            <div class="reset-container">
                <button class="btn-del" onclick="resetShiftCounter()" style="width:100%; max-width: 300px;">
                    RESET REFFED COUNT: <span id="counterVal">0</span>
                </button>
            </div>

            <div class="job-pool-config">
                <label><input type="checkbox" class="job-check" value="Lines 1" checked> Lines 1</label>
                <label><input type="checkbox" class="job-check" value="Bookkeeper" checked> Book</label>
                <label><input type="checkbox" class="job-check" value="Score" checked> Score</label>
                <label><input type="checkbox" class="job-check" value="Lines 2" checked> Lines 2</label>
                <label><input type="checkbox" class="job-check" value="Down Ref" checked> Down Ref</label>
                <label><input type="checkbox" class="job-check" value="Libero" checked> Libero</label>
            </div>

            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <input type="number" id="sets" value="3" style="width: 60px;" placeholder="Sets">
                <button class="btn-main" onclick="generate()">GENERATE SETS</button>
            </div>

            <div class="table-wrapper">
                <div id="assignTable"></div>
            </div>
        </div>

        <div id="captain-tool" class="tool-panel">
            <button class="btn-main" onclick="pick()">[ RANDOM CAPTAINS ]</button>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <div id="cap1" style="flex:1; background:#000; border:1px solid var(--neon-green); padding:20px; text-align:center; border-radius:10px;">?</div>
                <div id="cap2" style="flex:1; background:#000; border:1px solid var(--neon-green); padding:20px; text-align:center; border-radius:10px;">?</div>
            </div>
        </div>
    </section>
</main>

<script>
    let roster = JSON.parse(localStorage.getItem('vb-roster')) || [
        { name: "Player 1", number: "1", active: true },
        { name: "Player 2", number: "2", active: true },
        { name: "Player 3", number: "3", active: true },
        { name: "Player 4", number: "4", active: true }
    ];

    let globalPointer = parseInt(localStorage.getItem('vb-pointer')) || 0;
    let shiftCounter = parseInt(localStorage.getItem('vb-shift-counter')) || 0;

    function saveState() {
        localStorage.setItem('vb-pointer', globalPointer);
        localStorage.setItem('vb-shift-counter', shiftCounter);
        document.getElementById('counterVal').innerText = shiftCounter;
    }

    function render() {
        const container = document.getElementById('rosterBody');
        container.innerHTML = '';
        roster.forEach((p, i) => {
            container.innerHTML += `
                <div class="player-row">
                    <input type="checkbox" ${p.active ? 'checked' : ''} onchange="togglePlayer(${i})">
                    <input type="text" value="${p.name}" onchange="updateName(${i}, this.value)">
                    <input type="number" value="${p.number}" onchange="updateNum(${i}, this.value)">
                    <button class="btn-del" onclick="removePlayer(${i})">Ã—</button>
                </div>`;
        });
        document.getElementById('counterVal').innerText = shiftCounter;
    }

    function togglePlayer(i) { roster[i].active = !roster[i].active; }
    function updateName(i, val) { roster[i].name = val; }
    function updateNum(i, val) { roster[i].number = val; }
    function removePlayer(i) { roster.splice(i, 1); render(); }
    function addPlayer() { roster.push({ name: "", number: "", active: true }); render(); }
    function sortRoster() { roster.sort((a, b) => parseInt(a.number) - parseInt(b.number)); render(); }
    function saveRoster() { localStorage.setItem('vb-roster', JSON.stringify(roster)); alert("Saved!"); }
    function showTool(id, btn) {
        document.querySelectorAll('.tool-panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
    }

    function resetShiftCounter() {
        if(confirm("Reset all rotation counts?")) {
            shiftCounter = 0; globalPointer = 0; saveState(); render();
        }
    }

    function generate() {
        const activePlayers = roster.filter(p => p.active);
        const jobs = Array.from(document.querySelectorAll('.job-check:checked')).map(c => c.value);
        const numSets = parseInt(document.getElementById('sets').value);
        if (!activePlayers.length || !jobs.length) return;

        let html = `<table class="assignment-table"><thead><tr><th>Set</th>`;
        jobs.forEach(j => html += `<th>${j}</th>`);
        html += `</tr></thead><tbody>`;

        let currentPointer = globalPointer;
        const numJobs = jobs.length;

        for (let s = 0; s < numSets; s++) {
            html += `<tr><td><strong>${s + 1}</strong></td>`;
            let totalOffset = (shiftCounter * 11 + s) % numJobs;
            let setAssignments = new Array(numJobs);

            for (let j = 0; j < numJobs; j++) {
                let playerIdx = (currentPointer + j) % activePlayers.length;
                let targetJobIdx = (j + totalOffset) % numJobs;
                setAssignments[targetJobIdx] = activePlayers[playerIdx].name;
            }
            setAssignments.forEach(name => html += `<td>${name}</td>`);
            html += `</tr>`;

            for(let step = 0; step < numJobs; step++) {
                currentPointer++;
                if (currentPointer >= activePlayers.length) { currentPointer = 0; shiftCounter++; }
            }
        }
        globalPointer = currentPointer;
        saveState();
        document.getElementById('assignTable').innerHTML = html + `</tbody></table>`;
    }

    function pick() {
        const active = roster.filter(p => p.active);
        if (active.length < 2) return;
        const shuffled = [...active].sort(() => 0.5 - Math.random());
        document.getElementById('cap1').innerText = shuffled[0].name;
        document.getElementById('cap2').innerText = shuffled[1].name;
    }

    render();
</script>
</body>
</html>
